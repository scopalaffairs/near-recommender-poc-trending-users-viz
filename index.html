<head>
  <style>
    body {
      margin: 0;
      background-color: #2a2a2a;
      /* Dark grey background */
      color: #ffffff;
      /* White text for better contrast */
    }

    #graph {
      width: 100vw;
      height: 100vh;
    }
  </style>

  <script src="//unpkg.com/react/umd/react.production.min.js"></script>
  <script src="//unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
  <script src="//unpkg.com/@babel/standalone"></script>
  <script src="//unpkg.com/three"></script>
  <script src="//unpkg.com/react-force-graph-3d"></script>
</head>

<body>
  <div id="graph"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    fetch('./trending_users.json')
      .then((res) => res.json())
      .then((data) => {
        const distance = 1000;

        const GraphComponent = () => {
          const fgRef = useRef();
          const [highlightNodes, setHighlightNodes] = useState(new Set());
          const [hoverNode, setHoverNode] = useState(null);

          useEffect(() => {
            // Camera rotation setup
            let angle = 0;
            const interval = setInterval(() => {
              fgRef.current.cameraPosition(
                {
                  x: distance * Math.sin(angle),
                  z: distance * Math.cos(angle),
                },
                { x: 0, y: 0, z: 0 }, // Look at the graph center
                3000 // Transition duration in ms
              );
              angle += Math.PI / 200;
            }, 50);
            return () => clearInterval(interval);
          }, []);

          const handleNodeHover = (node) => {
            setHoverNode(node);
            setHighlightNodes(node ? new Set([node.id, ...node.neighbors]) : new Set());
          };

          const handleNodeClick = (node) => {
            alert(`Node clicked: ${node.id}`);
          };

          return (
            <ForceGraph3D
              ref={fgRef}
              graphData={data}
              backgroundColor="#2a2a2a"
              nodeAutoColorBy="group"
              linkColor={() => 'rgba(255,255,255,0.5)'}
              linkWidth={(link) =>
                highlightNodes.has(link.source.id) || highlightNodes.has(link.target.id) ? 2 : 1
              }
              linkDirectionalParticles={1}
              linkDirectionalParticleSpeed={0.02}
              nodeRelSize={5}
              nodeLabel={(node) => `User: ${node.id}\nGroup: ${node.group}`}
              nodeThreeObjectExtend={true}
              nodeThreeObject={(node) => {
                const obj = new THREE.Mesh(
                  new THREE.SphereGeometry(8),
                  new THREE.MeshStandardMaterial({
                    color: node === hoverNode ? 'gold' : node.color || '#00ffff',
                    opacity: 0.8,
                    transparent: true,
                  })
                );
                return obj;
              }}
              enableNodeDrag={true}
              onNodeHover={handleNodeHover}
              onNodeClick={handleNodeClick}
            />
          );
        };

        ReactDOM.render(<GraphComponent />, document.getElementById('graph'));
      });
  </script>
</body>